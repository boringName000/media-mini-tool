# ç¼“å­˜ç­–ç•¥ç»Ÿä¸€ä¼˜åŒ–

## é—®é¢˜åˆ†æ

### åŸå§‹é—®é¢˜
1. **ç¼“å­˜æ—¶é—´å†²çª**ï¼štimeUtils ä¸­å®šä¹‰äº†2å°æ—¶ç¼“å­˜ï¼Œä½† Store ä¸­ä¹Ÿå®šä¹‰äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´
2. **é‡å¤é€»è¾‘**ï¼šBaseStore å·²æœ‰å®Œæ•´çš„ç¼“å­˜ç®¡ç†ï¼ŒtimeUtils ä¸­é‡å¤å®ç°äº†è¿‡æœŸæ£€æŸ¥
3. **ä¸ç»Ÿä¸€çš„ç¼“å­˜ç­–ç•¥**ï¼šå„é¡µé¢ä½¿ç”¨ä¸åŒçš„ç¼“å­˜å¤„ç†æ–¹å¼

### è®¾è®¡å†²çª
- Store é…ç½®ï¼š`expireTime: 2 * 60 * 60 * 1000` (2å°æ—¶)
- BaseStore å†…ç½®ï¼š`isDataValid()` æ–¹æ³•æ£€æŸ¥è¿‡æœŸ
- timeUtils é‡å¤ï¼š`isCacheExpired()` å‡½æ•°é‡å¤å®ç°

## ä¼˜åŒ–æ–¹æ¡ˆ

### 1. ç»Ÿä¸€ç¼“å­˜ç­–ç•¥
**ä»¥ Store ä¸ºå‡†**ï¼šå®Œå…¨ä¾èµ– BaseStore çš„ç¼“å­˜ç®¡ç†æœºåˆ¶

### 2. ç§»é™¤é‡å¤é€»è¾‘
- åˆ é™¤ timeUtils ä¸­çš„ `isCacheExpired()` å‡½æ•°
- ä¿®æ”¹ `handleCacheWithTime()` ä½¿ç”¨ Store çš„ `getData()` æ–¹æ³•
- `getData()` å†…éƒ¨å·²è°ƒç”¨ `isDataValid()` æ£€æŸ¥è¿‡æœŸ

### 3. ä¼˜åŒ–ç¼“å­˜å¤„ç†æµç¨‹
```javascript
// æ–°çš„ç»Ÿä¸€æµç¨‹
const usedCache = await handleCacheWithTime({
  store: myStore,           // Storeå®ä¾‹
  fetchData: fetchFunction, // æ•°æ®è·å–å‡½æ•°
  refs: { cachedData, lastUpdateTime }, // Vue refs
  forceRefresh: false       // æ˜¯å¦å¼ºåˆ¶åˆ·æ–°
})
```

## å®ç°ç»†èŠ‚

### BaseStore ç¼“å­˜æœºåˆ¶
```javascript
// BaseStore.js ä¸­çš„ç¼“å­˜æ£€æŸ¥
isDataValid() {
  if (!this.data || !this.timestamp) return false
  
  const now = Date.now()
  const dataTime = this.timestamp
  
  if (this.options.dayOnly) {
    // æŒ‰å¤©æ£€æŸ¥ï¼ˆDashboardä½¿ç”¨ï¼‰
    return isSameDay(now, dataTime)
  } else {
    // æŒ‰è¿‡æœŸæ—¶é—´æ£€æŸ¥ï¼ˆå…¶ä»–é¡µé¢ä½¿ç”¨ï¼‰
    return (now - dataTime) < this.options.expireTime
  }
}

getData() {
  return this.isDataValid() ? this.data : null
}
```

### ç»Ÿä¸€çš„æ—¶é—´å·¥å…·å‡½æ•°
```javascript
// timeUtils.js ä¼˜åŒ–å
export const handleCacheWithTime = async ({ store, fetchData, refs, forceRefresh = false }) => {
  const { cachedData, lastUpdateTime } = refs
  
  if (forceRefresh) {
    await fetchData()
    return false
  }

  // ä½¿ç”¨Storeå†…ç½®çš„ç¼“å­˜æ£€æŸ¥
  const cached = store.getData() // å†…éƒ¨å·²æ£€æŸ¥isDataValid()
  const cachedTime = store.getUpdateTime()
  
  if (cached && cachedTime) {
    cachedData.value = cached
    lastUpdateTime.value = formatCachedTime(cachedTime)
    return true
  } else {
    await fetchData()
    return false
  }
}
```

## å„é¡µé¢ç¼“å­˜é…ç½®

### Dashboard (æŒ‰å¤©ç¼“å­˜)
```javascript
const dashboardStore = new BaseStore('dashboard', {
  dayOnly: true,           // æŒ‰å¤©è¿‡æœŸ
  enablePersist: false,    // ä¸æŒä¹…åŒ–
})
```

### å…¶ä»–é¡µé¢ (2å°æ—¶ç¼“å­˜)
```javascript
const xxxStore = new BaseStore('xxx', {
  expireTime: 2 * 60 * 60 * 1000,  // 2å°æ—¶è¿‡æœŸ
  enablePersist: false,
})
```

## ä¼˜åŒ–æ•ˆæœ

### 1. æ¶ˆé™¤è®¾è®¡å†²çª
- âœ… ç»Ÿä¸€ä½¿ç”¨ Store çš„ç¼“å­˜ç­–ç•¥
- âœ… ç§»é™¤ timeUtils ä¸­çš„é‡å¤é€»è¾‘
- âœ… é¿å…å¤šé‡è¿‡æœŸæ£€æŸ¥

### 2. ç®€åŒ–ä»£ç é€»è¾‘
- âœ… å„é¡µé¢ä½¿ç”¨ç»Ÿä¸€çš„ `handleCacheWithTime()` å‡½æ•°
- âœ… å‡å°‘é‡å¤çš„ç¼“å­˜å¤„ç†ä»£ç 
- âœ… ç»Ÿä¸€çš„æ—¶é—´æ ¼å¼åŒ–

### 3. æå‡å¯ç»´æŠ¤æ€§
- âœ… ç¼“å­˜ç­–ç•¥é›†ä¸­åœ¨ Store é…ç½®ä¸­
- âœ… æ—¶é—´ç›¸å…³é€»è¾‘ç»Ÿä¸€åœ¨ timeUtils ä¸­
- âœ… æ¸…æ™°çš„èŒè´£åˆ†ç¦»

## é¡µé¢æ›´æ–°çŠ¶æ€

### âœ… å·²ä¼˜åŒ–é¡µé¢
1. **ArticleAudit.vue** - ä½¿ç”¨ç»Ÿä¸€ç¼“å­˜ç­–ç•¥
2. **Dashboard.vue** - ä½¿ç”¨ç»Ÿä¸€ç¼“å­˜ç­–ç•¥  
3. **UsersAudit.vue** - å¯¼å…¥ä¼˜åŒ–çš„å·¥å…·å‡½æ•°
4. **Articles.vue** - å¯¼å…¥ä¼˜åŒ–çš„å·¥å…·å‡½æ•°
5. **Invitations.vue** - å¯¼å…¥ä¼˜åŒ–çš„å·¥å…·å‡½æ•°
6. **Accounts.vue** - å¯¼å…¥ä¼˜åŒ–çš„å·¥å…·å‡½æ•°

### ğŸ”§ æ ¸å¿ƒæ”¹è¿›
- æ‰€æœ‰é¡µé¢ç»Ÿä¸€ä½¿ç”¨ `handleCacheWithTime()` å¤„ç†ç¼“å­˜
- æ—¶é—´æ˜¾ç¤ºç»Ÿä¸€ä½¿ç”¨ `updatePageTime()` æ›´æ–°
- ç¼“å­˜è¿‡æœŸå®Œå…¨ä¾èµ– Store çš„ `isDataValid()` æ–¹æ³•

## ä½¿ç”¨ç¤ºä¾‹

### æ ‡å‡†ç¼“å­˜å¤„ç†
```javascript
// åœ¨é¡µé¢çš„æ•°æ®è·å–å‡½æ•°ä¸­
const loadData = async (forceRefresh = false) => {
  const usedCache = await handleCacheWithTime({
    store: myStore,
    fetchData: async () => {
      // å®é™…çš„æ•°æ®è·å–é€»è¾‘
      const result = await apiCall()
      myData.value = result.data
      myStore.setData(result.data)
      updatePageTime({ lastUpdateTime }, myStore)
    },
    refs: { cachedData: myData, lastUpdateTime },
    forceRefresh
  })
  
  if (usedCache) {
    console.log('ä½¿ç”¨ç¼“å­˜æ•°æ®')
  }
}
```

### åˆ·æ–°æŒ‰é’®å¤„ç†
```javascript
const handleRefresh = () => {
  loadData(true) // å¼ºåˆ¶åˆ·æ–°
}
```

## æ³¨æ„äº‹é¡¹

1. **Store é…ç½®ä¸ºå‡†**ï¼šæ‰€æœ‰ç¼“å­˜æ—¶é—´ä»¥ Store é…ç½®ä¸ºå‡†
2. **ä¸è¦é‡å¤æ£€æŸ¥**ï¼šä¸è¦åœ¨é¡µé¢ä¸­å†æ¬¡æ£€æŸ¥ç¼“å­˜è¿‡æœŸ
3. **ç»Ÿä¸€æ—¶é—´æ ¼å¼**ï¼šä½¿ç”¨ `updatePageTime()` ç¡®ä¿æ—¶é—´æ ¼å¼ä¸€è‡´
4. **é”™è¯¯å¤„ç†**ï¼šç¼“å­˜å¤„ç†å¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°æ•°æ®åˆ·æ–°

è¿™æ ·çš„è®¾è®¡ç¡®ä¿äº†ç¼“å­˜ç­–ç•¥çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚