# get-user-info äº‘å‡½æ•°æ¯æ—¥ä»»åŠ¡æ›´æ–°ä¼˜åŒ–

## ğŸ“‹ ä¼˜åŒ–æ¦‚è¿°

åœ¨ `get-user-info` äº‘å‡½æ•°ä¸­ï¼Œæ·»åŠ äº†å‰ç½®åˆ¤æ–­é€»è¾‘ï¼Œé¿å…ä¸å¿…è¦çš„ `create-daily-tasks` äº‘å‡½æ•°è°ƒç”¨ï¼Œæå‡æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚

## ğŸ”§ ä¼˜åŒ–å†…å®¹

### **1. å‰ç½®åˆ¤æ–­é€»è¾‘**

åœ¨è°ƒç”¨ `create-daily-tasks` äº‘å‡½æ•°ä¹‹å‰ï¼Œå…ˆæ£€æŸ¥ç”¨æˆ·çš„è´¦å·å’Œæ¯æ—¥ä»»åŠ¡çŠ¶æ€ï¼š

#### **æ£€æŸ¥æ¡ä»¶**

- âœ… **æ— è´¦å·**: ç”¨æˆ·æ²¡æœ‰è´¦å·ï¼Œè·³è¿‡æ¯æ—¥ä»»åŠ¡æ›´æ–°
- âœ… **æ— æ¯æ—¥ä»»åŠ¡**: è´¦å·æ²¡æœ‰ `dailyTasks` æ•°ç»„æˆ–æ•°ç»„ä¸ºç©ºï¼Œéœ€è¦åˆå§‹åŒ–
- âœ… **ä»»åŠ¡è¿‡æœŸ**: æ£€æŸ¥ `dailyTasks` ä¸­çš„ä»»åŠ¡æ—¶é—´æ˜¯å¦è¿‡æœŸ

#### **è¿‡æœŸåˆ¤æ–­é€»è¾‘**

```javascript
const now = new Date();
const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

for (const task of dailyTasks) {
  if (!task.taskTime) continue;

  const taskDate = new Date(task.taskTime);
  const taskDay = new Date(
    taskDate.getFullYear(),
    taskDate.getMonth(),
    taskDate.getDate()
  );

  if (taskDay < today) {
    // å‘ç°è¿‡æœŸä»»åŠ¡ï¼Œéœ€è¦æ›´æ–°
    needUpdateDailyTasks = true;
    break;
  }
}
```

### **2. æ¡ä»¶è°ƒç”¨**

åªæœ‰åœ¨ä»¥ä¸‹æƒ…å†µä¸‹æ‰è°ƒç”¨ `create-daily-tasks` äº‘å‡½æ•°ï¼š

- ç”¨æˆ·æœ‰è´¦å·
- è´¦å·ç¼ºå°‘æ¯æ—¥ä»»åŠ¡æ•°æ®
- å­˜åœ¨è¿‡æœŸçš„æ¯æ—¥ä»»åŠ¡

### **3. æ—¥å¿—è®°å½•**

æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§ï¼š

- æ— è´¦å·æ—¶çš„è·³è¿‡æ—¥å¿—
- éœ€è¦åˆå§‹åŒ–çš„è´¦å·ä¿¡æ¯
- è¿‡æœŸä»»åŠ¡çš„è´¦å·ä¿¡æ¯
- æ— éœ€æ›´æ–°æ—¶çš„è·³è¿‡æ—¥å¿—

## ğŸ¯ ä¼˜åŒ–æ•ˆæœ

### **æ€§èƒ½æå‡**

- âœ… **å‡å°‘äº‘å‡½æ•°è°ƒç”¨**: é¿å…ä¸å¿…è¦çš„ `create-daily-tasks` è°ƒç”¨
- âœ… **é™ä½å»¶è¿Ÿ**: å‡å°‘ç½‘ç»œè¯·æ±‚å’Œæ•°æ®åº“æ“ä½œ
- âœ… **èŠ‚çœèµ„æº**: å‡å°‘äº‘å‡½æ•°æ‰§è¡Œæ¬¡æ•°å’Œè´¹ç”¨

### **ç”¨æˆ·ä½“éªŒ**

- âœ… **å“åº”æ›´å¿«**: `get-user-info` å“åº”æ—¶é—´æ›´çŸ­
- âœ… **æ•°æ®å‡†ç¡®**: åªåœ¨çœŸæ­£éœ€è¦æ—¶æ›´æ–°æ¯æ—¥ä»»åŠ¡
- âœ… **ç¨³å®šæ€§**: å‡å°‘äº‘å‡½æ•°è°ƒç”¨å¤±è´¥çš„é£é™©

## ğŸ“Š ä½¿ç”¨åœºæ™¯

### **åœºæ™¯ 1: æ–°ç”¨æˆ·**

- ç”¨æˆ·åˆšæ³¨å†Œï¼Œæ²¡æœ‰è´¦å·
- å‰ç½®åˆ¤æ–­ï¼šæ— è´¦å· â†’ è·³è¿‡æ¯æ—¥ä»»åŠ¡æ›´æ–°
- ç»“æœï¼šä¸è°ƒç”¨ `create-daily-tasks`

### **åœºæ™¯ 2: æœ‰è´¦å·ä½†æ— æ¯æ—¥ä»»åŠ¡**

- ç”¨æˆ·æœ‰è´¦å·ï¼Œä½† `dailyTasks` ä¸ºç©º
- å‰ç½®åˆ¤æ–­ï¼šéœ€è¦åˆå§‹åŒ– â†’ è°ƒç”¨ `create-daily-tasks`
- ç»“æœï¼šåˆ›å»ºåˆå§‹æ¯æ—¥ä»»åŠ¡

### **åœºæ™¯ 3: ä»»åŠ¡æœªè¿‡æœŸ**

- ç”¨æˆ·æœ‰è´¦å·ï¼Œæ¯æ—¥ä»»åŠ¡éƒ½åœ¨ä»Šå¤©æˆ–æœªæ¥
- å‰ç½®åˆ¤æ–­ï¼šæ— éœ€æ›´æ–° â†’ è·³è¿‡äº‘å‡½æ•°è°ƒç”¨
- ç»“æœï¼šç›´æ¥è¿”å›ç”¨æˆ·ä¿¡æ¯

### **åœºæ™¯ 4: ä»»åŠ¡å·²è¿‡æœŸ**

- ç”¨æˆ·æœ‰è´¦å·ï¼Œå­˜åœ¨è¿‡æœŸçš„æ¯æ—¥ä»»åŠ¡
- å‰ç½®åˆ¤æ–­ï¼šéœ€è¦æ›´æ–° â†’ è°ƒç”¨ `create-daily-tasks`
- ç»“æœï¼šæ›´æ–°è¿‡æœŸä»»åŠ¡

## ğŸ” ä»£ç ä½ç½®

**æ–‡ä»¶**: `miniTool/cloudfunctions/get-user-info/index.js`

**å…³é”®ä»£ç æ®µ**:

```javascript
// å‰ç½®åˆ¤æ–­ï¼šæ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°æ¯æ—¥ä»»åŠ¡
let needUpdateDailyTasks = false;
const accounts = user.accounts || [];

if (accounts.length === 0) {
  // æ²¡æœ‰è´¦å·ï¼Œä¸éœ€è¦æ›´æ–°æ¯æ—¥ä»»åŠ¡
  console.log("ç”¨æˆ·æ²¡æœ‰è´¦å·ï¼Œè·³è¿‡æ¯æ—¥ä»»åŠ¡æ›´æ–°");
} else {
  // æ£€æŸ¥æ¯ä¸ªè´¦å·çš„æ¯æ—¥ä»»åŠ¡çŠ¶æ€
  for (const account of accounts) {
    const dailyTasks = account.dailyTasks || [];

    if (dailyTasks.length === 0) {
      // è´¦å·æ²¡æœ‰æ¯æ—¥ä»»åŠ¡ï¼Œéœ€è¦åˆå§‹åŒ–
      needUpdateDailyTasks = true;
      console.log(`è´¦å· ${account.accountId} æ²¡æœ‰æ¯æ—¥ä»»åŠ¡ï¼Œéœ€è¦åˆå§‹åŒ–`);
      break;
    }

    // æ£€æŸ¥æ˜¯å¦æœ‰è¿‡æœŸçš„ä»»åŠ¡
    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

    for (const task of dailyTasks) {
      if (!task.taskTime) continue;

      const taskDate = new Date(task.taskTime);
      const taskDay = new Date(
        taskDate.getFullYear(),
        taskDate.getMonth(),
        taskDate.getDate()
      );

      if (taskDay < today) {
        // å‘ç°è¿‡æœŸä»»åŠ¡ï¼Œéœ€è¦æ›´æ–°
        needUpdateDailyTasks = true;
        console.log(`è´¦å· ${account.accountId} æœ‰è¿‡æœŸä»»åŠ¡ï¼Œéœ€è¦æ›´æ–°`);
        break;
      }
    }

    if (needUpdateDailyTasks) break;
  }
}

// åªæœ‰åœ¨éœ€è¦æ›´æ–°æ—¶æ‰è°ƒç”¨ create-daily-tasks äº‘å‡½æ•°
if (needUpdateDailyTasks) {
  // è°ƒç”¨äº‘å‡½æ•°é€»è¾‘
} else {
  console.log("æ¯æ—¥ä»»åŠ¡æ— éœ€æ›´æ–°ï¼Œè·³è¿‡äº‘å‡½æ•°è°ƒç”¨");
}
```

## ğŸ“ˆ ç›‘æ§å»ºè®®

### **æ—¥å¿—ç›‘æ§**

- ç›‘æ§ "è·³è¿‡æ¯æ—¥ä»»åŠ¡æ›´æ–°" çš„æ—¥å¿—é¢‘ç‡
- ç›‘æ§ "éœ€è¦åˆå§‹åŒ–" å’Œ "æœ‰è¿‡æœŸä»»åŠ¡" çš„æ—¥å¿—
- ç›‘æ§äº‘å‡½æ•°è°ƒç”¨æˆåŠŸ/å¤±è´¥ç‡

### **æ€§èƒ½æŒ‡æ ‡**

- `get-user-info` å“åº”æ—¶é—´
- `create-daily-tasks` è°ƒç”¨é¢‘ç‡
- äº‘å‡½æ•°æ‰§è¡Œæ¬¡æ•°å’Œè´¹ç”¨

## ğŸš€ åç»­ä¼˜åŒ–

### **å¯èƒ½çš„è¿›ä¸€æ­¥ä¼˜åŒ–**

1. **ç¼“å­˜æœºåˆ¶**: å¯¹æ¯æ—¥ä»»åŠ¡çŠ¶æ€è¿›è¡ŒçŸ­æœŸç¼“å­˜
2. **æ‰¹é‡å¤„ç†**: å¯¹å¤šä¸ªè´¦å·çš„æ¯æ—¥ä»»åŠ¡è¿›è¡Œæ‰¹é‡æ›´æ–°
3. **å¼‚æ­¥æ›´æ–°**: å°†æ¯æ—¥ä»»åŠ¡æ›´æ–°æ”¹ä¸ºå¼‚æ­¥å¤„ç†ï¼Œä¸é˜»å¡ç”¨æˆ·ä¿¡æ¯è·å–
4. **æ™ºèƒ½è°ƒåº¦**: æ ¹æ®ç”¨æˆ·æ´»è·ƒæ—¶é—´æ™ºèƒ½å®‰æ’ä»»åŠ¡æ›´æ–°æ—¶é—´
